use std::panic::{ assert };
use std::io::{ io };

func test_sub(a: i64&) {
    a -= 1;
}

func test_add(a: i64&) {
    a += 1;
}

func test_mul(a: i64&) {
    a *= 2;
}

func test_div(a: i64&) {
    a /= 2;
}

func test_assign(a: i64&) {
    a = 114;
}

struct s {
    a: i64
}

func test_replace_struct(a: s&) {
    a = s { a: 1919810 };
}

func test_ref_struct(a: s&) {
    a.a = 114514;
}

func test_ref_return(a: s&) -> i64& {
    return a.a;
}

func test_ref_arg(a: i64&) -> i64& {
    return a;
}

func main() -> i32 {
    var a = 1;
    test_sub(a);
    assert(a == 0, "a != 0");
    test_add(a);
    assert(a == 1, "a != 1");
    test_mul(a);
    assert(a == 2, "a != 2");
    test_div(a);
    assert(a == 1, "a != 1");
    test_assign(a);
    assert(a == 114, "a != 114");

    var b = s { a: 1 };
    test_sub(b.a);
    assert(b.a == 0, "b.a != 0");
    test_add(b.a);
    assert(b.a == 1, "b.a != 1");
    test_mul(b.a);
    assert(b.a == 2, "b.a != 2");
    test_div(b.a);
    assert(b.a == 1, "b.a != 1");
    test_assign(b.a);
    assert(b.a == 114, "b.a != 114");
    test_ref_struct(b);
    assert(b.a == 114514, "b.a != 114514");
    test_replace_struct(b);
    assert(b.a == 1919810, "b.a != 1919810");

    test_ref_return(b) = 114514;
    assert(b.a == 114514, "b.a != 114514");
    test_ref_return(b) = 1919810;
    assert(b.a == 1919810, "b.a != 1919810");

    test_ref_arg(test_ref_return(b)) = 0;
    assert(b.a == 0, "b.a != 0");
    test_add(test_ref_arg(test_ref_return(b)));
    assert(b.a == 1, "b.a != 1");
    test_mul(test_ref_arg(test_ref_return(b)));
    assert(b.a == 2, "b.a != 2");
    test_div(test_ref_arg(test_ref_return(b)));
    assert(b.a == 1, "b.a != 1");
    test_sub(test_ref_arg(test_ref_return(b)));
    assert(b.a == 0, "b.a != 0");

    test_ref_arg(test_ref_return(b)) = 114514;
    assert(b.a == 114514, "b.a != 114514");
    test_ref_arg(test_ref_return(b)) = 1919810;
    assert(b.a == 1919810, "b.a != 1919810");

    io::stdout().out("[ref_variable_assign] ok\n");
    return 0;
}